"use strict";angular.module("frontendApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ng-token-auth"]).config(["$routeProvider","$authProvider",function(a,b){b.configure({apiUrl:"https://hackaton-nubank.herokuapp.com"}),a.when("/skills",{templateUrl:"views/skills.html",controller:"SkillsCtrl"}).when("/messages",{templateUrl:"views/messages.html",controller:"MessagesCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/user/:user_id/mission/add",{templateUrl:"views/mission/add.html",controller:"MissionAddCtrl",resolve:{auth:["$auth",function(a){return a.validateUser()}]}}).when("/user/:user_id/mission/:id",{templateUrl:"views/mission/show.html",controller:"MissionShowCtrl",resolve:{auth:["$auth",function(a){return a.validateUser()}]}}).when("/user/:user_id/mission/:mission_id/task",{templateUrl:"views/task/index.html",controller:"TaskIndexCtrl",resolve:{auth:["$auth",function(a){return a.validateUser()}]}}).when("/user/:user_id/mission",{templateUrl:"views/mission/index.html",controller:"MissionIndexCtrl",resolve:{auth:["$auth",function(a){return a.validateUser()}]}}).when("/user/:id/show",{templateUrl:"views/user/show.html",controller:"UserShowCtrl",resolve:{auth:["$auth",function(a){return a.validateUser()}]}}).otherwise({redirectTo:"/login"})}]).run(["$rootScope","$location","User","UserServer",function(a,b,c,d){a.$on("auth:validation-success",function(a,b){var e=d.get({id:b.id});e.$promise.then(function(a){c.set(a)})}),a.$on("auth:validation-error",function(a,d){c.set({}),b.path("/login")}),a.$on("auth:invalid",function(a){console.log(a),b.path("/login")})}]),angular.module("frontendApp").controller("SkillsCtrl",["$scope","Skill",function(a,b){a.skills=b.query()}]),angular.module("frontendApp").service("Mission",["$resource","APIConfig",function(a,b){return a(b.endpoint+"users/:user_id/missions/:id",{id:"@_id"},{update:{method:"POST"},get:{method:"GET",params:{user_id:"@user_id"}},query:{method:"GET",params:{user_id:"@user_id"}}})}]),angular.module("frontendApp").service("Skill",["$resource","APIConfig",function(a,b){return a(b.endpoint+"skills/:id",{id:"@_id"},{update:{method:"PUT"},query:{method:"GET"}})}]),angular.module("frontendApp").constant("APIConfig",{endpoint:"https://hackaton-nubank.herokuapp.com/"}),angular.module("frontendApp").service("User",function(){this.get=function(){return angular.fromJson(sessionStorage.userService)},this.set=function(a){sessionStorage.userService=angular.toJson(a)}}),angular.module("frontendApp").service("Message",["$resource","APIConfig",function(a,b){return a(b.endpoint+"messages/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("frontendApp").controller("LoginCtrl",["$scope","$auth","$location","UserServer",function(a,b,c,d){a.login={email:"",password:""},a.signIn=function(){b.submitLogin(a.login).then(function(a){if(a.id){var b=d.get({id:a.id});b.$promise.then(function(a){a.has_mission?c.path("/user/"+a.id+"/mission"):c.path("/user/"+a.id+"/mission/add")})}}).catch(function(a){console.log(a)})}}]),angular.module("frontendApp").controller("MenuCtrl",["$scope","$auth","$location","User","$routeParams",function(a,b,c,d,e){a.current_user=d.get(),console.log(a.current_user.total_xp),a.goProfile=function(){c.path("/user/"+e.id+"/show")},a.goMission=function(){c.path("/user/"+e.user_id+"/mission/")},a.signOut=function(){b.signOut().then(function(a){console.log(a),c.path("/login")}).catch(function(a){console.log(a)})}}]),angular.module("frontendApp").controller("MessagesCtrl",["$scope","Message",function(a,b){a.messages=b.query()}]),angular.module("frontendApp").controller("MissionAddCtrl",["$scope","$auth","$routeParams","$location","Mission",function(a,b,c,d,e){a.mission={mission:{name:"",description:"",goal:"",value:"",duration_month:1,user_id:c.user_id}},a.addMission=function(){var b=new e(a.mission),c=b.$save();c.then(function(a){d.path("/mission/"+a.id+"/task")})}}]),angular.module("frontendApp").controller("MissionShowCtrl",["$scope","$routeParams","$location","Mission",function(a,b,c,d){a.showMission=function(a){c.path("/user/"+b.user_id+"/mission/"+a+"/task")},a.addMission=function(){var b=new d(a.mission),e=b.$save();e.then(function(a){c.path("/mission/"+a.id+"/task")})}}]),angular.module("frontendApp").component("taskModal",{templateUrl:"views/modal/task.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var a=this;a.$onInit=function(){a.task=a.resolve.task},a.ok=function(){a.close({$value:a.task})},a.cancel=function(){a.dismiss({$value:"cancel"})}}}),angular.module("frontendApp").controller("UserShowCtrl",["$scope","User",function(a,b){a.user=b.get()}]),angular.module("frontendApp").controller("TaskIndexCtrl",["$scope","$uibModal","$routeParams","Task","Mission","User","UserServer",function(a,b,c,d,e,f,g){a.mission=e.get({id:c.mission_id,user_id:c.user_id}),a.showTask=function(c){a.task=c;var e=b.open({animation:!1,component:"taskModal",resolve:{task:function(){return a.task}}});e.result.then(function(a){var b=a;b.completed=!0,b=new d(b),b.$update({mission_id:a.mission_id,id:a.id});var c=f.get(),e=g.get({id:c.id});e.$promise.then(function(a){f.set(a)})},function(){console.log("ali")})}}]),angular.module("frontendApp").service("Task",["$resource","APIConfig",function(a,b){return a(b.endpoint+"admin/missions/:mission_id/tasks/:id",{id:"@_id"},{update:{method:"PUT"},get:{method:"GET",params:{mission_id:"@mission_id"}}})}]),angular.module("frontendApp").service("UserServer",["$resource","APIConfig",function(a,b){return a(b.endpoint+"users/:id",{id:"@_id"},{update:{method:"PUT"},get:{method:"GET"}})}]),angular.module("frontendApp").controller("MissionIndexCtrl",["$scope","$routeParams","$location","Mission",function(a,b,c,d){a.userMission=d.query({user_id:b.user_id}),a.showMission=function(a){c.path("/user/"+b.user_id+"/mission/"+a+"/task")},a.goMission=function(){c.path("/user/"+b.user_id+"/mission/add")}}]),angular.module("frontendApp").run(["$templateCache",function(a){a.put("views/activities.html",'<p>This is the activities view.</p> <ul> <li ng-repeat="act in activity track by act.id"> {{act.name}} </li> </ul>'),a.put("views/activity/index.html",'<p>This is the activities view.</p> <ul> <li ng-repeat="act in activities track by act.id" ng-click="showActivity(act.id)"> {{act.name}} </li> </ul>'),a.put("views/login.html",'<div class="container-login"> <div class="row"> <div class="col-md-12"> <div class="center-block center-logo"> <p class="logo"> <img src="images/logo.a5fd197d.png"> </p> </div> <form novalidate> <div class="form-group"> <label for="email">E-mail:</label> <input class="form-control" type="text" ng-model="login.email"> </div> <div class="form-group"> <label for="senha">Senha:</label> <input class="form-control" type="password" ng-model="login.password"> </div> <button class="btn btn-primary btn-lg btn-block" type="submit" name="button" ng-click="signIn()">Entrar</button> </form> </div> </div> </div>'),a.put("views/messages.html",'<p>This is the messages view.</p> <ul> <li ng-repeat="message in messages track by message.id"> {{message.id}} </li> </ul>'),a.put("views/mission/add.html",'<div class="row"> <form novalidate> <div class="form-group"> <label class=""> Nome de seu objetivo? </label> <input type="text" class="form-control" placeholder="Nome o seu objetivo" ng-model="mission.mission.name"><br> <label class=""> Descreva seu objetivo? </label> <input type="text" class="form-control" placeholder="Descreva seu objetivo" ng-model="mission.mission.description"><br> <label class=""> Qual item? </label> <input type="text" class="form-control" placeholder="Item do objetivo" ng-model="mission.mission.goal"><br> <label class=""> Valor do item? </label> <input type="number" class="form-control" placeholder="Digite o valor do objetivo" ng-model="mission.mission.value"><br> <label class=""> Você quer atingir o objetivo em quanto tempo? </label> <select class="form-control" ng-model="mission.mission.duration_month"> <option value="1">1</option> <option value="2">2</option> <option value="3">3</option> <option value="4">4</option> <option value="5">5</option> <option value="6">6</option> <option value="7">7</option> <option value="8">8</option> <option value="9">9</option> <option value="10">10</option> <option value="11">11</option> <option value="12">12</option> </select> <br> <input type="hidden" ng-model="mission.mission.user_id"> <button type="submit" class="btn btn-success pull-right" name="button" ng-click="addMission()">Cadastrar objetivo</button> </div> </form> </div>'),a.put("views/mission/index.html",'<div class="list-group"> <div class="row"> <h1> <span class="glyphicon glyphicon-star"></span> MISSÕES <button type="button" class="btn btn-primary col-md-3 pull-right btn-add-mission" ng-click="goMission()">Adicionar missão</button> </h1> </div> <div class="row"> <a href="" class="list-group-item" ng-repeat="mission in userMission.missions track by mission.id" ng-click="showMission(mission.id)"> <div class="row"> <div class="col-md-10 col-xs-10"> <h4 class="list-group-item-heading">{{mission.name}}</h4> </div> <div class="col-md-2 col-xs-2"> <span class="label label-primary">{{mission.tasks.length}}</span> </div> </div> </a> </div> </div>'),a.put("views/mission/show.html",'<p>Missão {{mission.title}}</p> <ul> <li ng-repeat="task in mission.tasks track by task.id" ng-click="showActivity(task.id)"> {{act.name}} </li> </ul>'),a.put("views/modal/task.html",'<div class="modal-header"> <h3 class="modal-title" id="modal-title">Caramba! Que sensacional!</h3> </div> <div class="modal-body" id="modal-body"> <p>Você acabou de finalizar a atividade <b>{{$ctrl.task.description}}</b>. Ela valia {{$ctrl.task.xp}} pontos de XP e {{$ctrl.task.value | currency:"R$"}}. </p> <p>Para seguir adiante e conseguir seus pontos, clique em um dos botões abaixo. </p> </div> <div class="modal-footer"> <button class="btn btn-success" type="button" ng-click="$ctrl.ok()">Completei! =)</button> <button class="btn btn-danger" type="button" ng-click="$ctrl.cancel()">Não completei =(</button> </div>'),a.put("views/skills.html",'<p>This is the skills view.</p> <ul> <li ng-repeat="skill in skills track by skill.id"> {{skill.name}} </li> </ul>'),a.put("views/task/index.html",'<div class="list-group"> <h1><i class="mission-star glyphicon glyphicon-star"> MISSÃO <small>{{mission.name}}</small></h1> <a href="" class="list-group-item" ng-repeat="task in mission.tasks track by task.id" ng-click="showTask(task)"> <h4 class="list-group-item-heading">{{task.title}}</h4> <p class="list-group-item-text"> <div class="row"> <div class="col-md-2 col-xs-3"> <i ng-show="task.completed" class="task-icon task-completed glyphicon glyphicon-ok"> <i ng-show="!task.completed" class="task-icon task-pending glyphicon glyphicon-time"> </div> <div class="col-md-10 col-xs-9"> <div class="row"> <div class="col-md-12"> <span class="task-description"> <strong> {{task.description}} </strong></span> </div> </div> <div class="row"> <div class="col-md-6"> <span class="task-xp"> {{task.xp}}</span> <strong>xp</strong> </div> <div class="col-md-6"> <div class="row"> <div class="col-md-12"> <span class="task-value"> R$ {{task.value}} </span> </div> </div> <div class="row"> <div class="col-md-12"> <span class="task-end_date"> <strong>Término: </strong>{{task.end_date | date : \'dd\'/\'MM\'/\'yyyy\': pt_BR}} </span> </div> </div> </div> </div> </div> </div> </p> </a> </div>'),a.put("views/user/show.html",'<div class="list-group"> <h1><span class="glyphicon glyphicon-user"></span> PERFIL</h1> <a href="" class="list-group-item"> <p class="list-group-item-text" style="font-size:18px"> <img src="images/yeoman.8cb970fb.png" class="img-circle img-responsive center-block"> <strong>Nome: </strong>Cândido <br> <strong>E-mail: </strong>{{user.email}} <br> <strong>Apelido: </strong>{{user.nickname}} <br> </p> </a> </div>'),a.put("views/users.html",'<p>This is the users view.</p> <ul> <li ng-repeat="user in users track by user.id"> {{user.name}} </li> </ul>')}]);